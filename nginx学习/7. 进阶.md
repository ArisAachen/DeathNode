## 扩容  

### 单机扩容 (垂直扩容) 
增加硬件资源    
HDD   STA  SSD  带宽  等 

### 水平扩容 
集群化     

#### 集群 nginx 的特点 
不保存 用户的 session 会话    
1. ip_hash        
中小型项目, 可能会造成流量倾斜 和 cookie上下文 丢失    

cookie_jsessionid    
将 json id 写入 url 上, jsessionid 是由 tomcat 等下发的,   
如果没有 tomcat 和 hash 其他 

request_uri        
访问相同的 url 时, 会被转发到相同的 机器, 在不 支持 cookie 的机器, 可以做到会话保持      

使用 lua 二次开发实现 定向流量分发    

2. redis + spring session     
性能比 nginx 保持会话低, 当请求多时, redis 压力大, 系统设计的复杂度高  
![session_redis](../asset/ngnix_session_redis.png)    

3. sticky 模块 会话保持     
不需要上有服务器支持 session 即可保持会话  


#### 集群化 细分  
1. 数据分区    
将一部分数据分别放在不同的机器上, 其他的放在另外的机器上   

2. 上游服务 SOA 化  
spring cloud  服务器技术架构, 拆分更细的模块    
nginx 可以拆分成 (每个 nginx 代理后端的某个服务集群)  

3. 入口细分  

4. 数据异构化   
多级缓存:   客户端缓存    CDN缓存   异地缓存   nginx缓存     

5. 服务异步化  
拆分请求:   
拆分请求(将一个请求拆分为多个请求, 下载前告诉用户多大, 再多线程请求下载, 或者不完全展示靠点击触发)    
消息中间件    


 
### 扩容原则 
无状态原则    
弹性原则    